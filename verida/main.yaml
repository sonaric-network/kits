namespace: verida

common:
  metadata:
    name: Verida
    shortname: Verida
    description: >-
      Verida is a multi-chain protocol for interoperable database storage and
      messaging built on decentralized identity where personal data is owned and
      controlled by users.
    network: verida
    publisher: Sonaric
    website: 'https://www.verida.network/'
    source: 'https://github.com/verida/storage-node'
    currency: VDT
    icon: 'https://plotter.blob.core.windows.net/icons/60x60.verida1708085851923.png'
    tags: >-
      blockchain,wallet,bridge,decentralized databases,data
      security,confidential compute,private
      data,ai,zero-knowledge,self-custody,personal data bridge,verida
      wallet,verida token,verida vault,verida missions,network
      explorer,credentials and identity,decentralized identifier
      (did),web3,storage node providers

mainnet-storage-node:
  defines: runnable
  inherits: verida/common
  metadata:
    name: Verida Mainnet Storage Node
    shortname: mainnet-storage-node
    description: >-
      A Verida Mainnet Storage Node provides authentication and authorization
      over CouchDB, handling data storage and messaging.
    network: mainnet-storage-node
  requirements:
    CPU: 4 cores
    RAM: 8192
    GPU: false
    disk: 100
  containers:
    node:
      image: 'verida/storage-node:latest'
      paths:
        - '<- `${monk-volume-path}/data-storage:/var/lib/verida/data`'
        - '<- `${monk-volume-path}/config-files:/var/lib/verida/etc`'
        - '<- `${monk-volume-path}/docker-compose:/var/lib/verida/dockercompose`'
        - '<- `${monk-volume-path}/operational-scripts:/var/lib/verida/bin`'
        - '<- `${monk-volume-path}/backup-storage:/var/lib/verida/backups`'
  files:
    init:
      container: node
      path: /sonaric-init.sh
      mode: '0755'
      contents: >-
        #!/bin/bash

        # Install Node.js and npm

        curl -sL https://deb.nodesource.com/setup_14.x | sudo -E bash -

        sudo apt-get install -y nodejs


        # Run the Verida Node Installer

        curl -s -L https://assets.verida.io/datanodeinstaller/install.sh | bash


        # Backup Configuration Files

        cp /var/lib/verida/etc/verida-node-config.yaml /var/lib/verida/backups/

        cp /var/lib/verida/etc/verida-node-config.tgz /var/lib/verida/backups/


        # Setup a New Machine

        setup-verida-node --inputconfig
        /var/lib/verida/etc/verida-node-config.yaml


        # Delete Setup Files

        rm -rf /var/lib/verida/etc/setupfiles
  services:
    ssh:
      container: node
      port: 22
      host-port: 22
      protocol: tcp
      publish: true
    https:
      container: node
      port: 443
      host-port: 443
      protocol: tcp
      publish: true
    http:
      container: node
      port: 80
      host-port: 80
      protocol: tcp
      publish: true
  variables:
    domain_name:
      description: The domain name pointing to the node.
      type: string
      env: DOMAIN_NAME
      default: ''

